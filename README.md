# Angelie

This project is a component of project Poseidon (connected swimming pool)  
[Link to diagram](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbkQxW2FuZ2VsaWUgY29tcGF0aWJsZSBkZXZpY2VdLS0-bXF0dDFcbkQyW2FuZ2VsaWUgY29tcGF0aWJsZSBkZXZpY2VdLS0-bXF0dDFcbkQ1W2FuZ2VsaWUgY29tcGF0aWJsZSBkZXZpY2VdLS0-fGh0dHB8YW5nZWxpZVxuRDNbYW5nZWxpZSB1bmNvbXBhdGlibGUgZGV2aWNlXS0tPm1xdHQyXG5ENFthbmdlbGllIHVuY29tcGF0aWJsZSBkZXZpY2VdLS0-bXF0dDJcbkQ2W2FuZ2VsaWUgdW5jb21wYXRpYmxlIGRldmljZV0tLT58aHR0cHxvdGhlclxubXF0dDEobXF0dDogL2FuZ2VsaWUvKiktLT5hbmdlbGllXG5tcXR0MihtcXR0OiAvb3RoZXIvKiktLT5vdGhlclxuYW5nZWxpZVthbmdlbGllIGRlY29kZXJdLS0-a2Fma2FfdGVsZW1ldHJpZXNcbm90aGVyW290aGVyIGRlY29kZXJdLS0-a2Fma2FfdGVsZW1ldHJpZXNcblxua2Fma2FfdGVsZW1ldHJpZXMoa2Fma2E6IHRlbGVtZXRyaWVzKS0tPkF0aGVuYVtBdGhlbmFdXG5cbmthZmthX3B1c2h0ZWxlbWV0cnktLT5IeWdpZVxuSHlnaWUtLT5rYWZrYV9hbGVydHNcbmthZmthX2FsZXJ0cyhrYWZrYTogYWxlcnRzKS0tPkhlcm1lc1xua2Fma2Ffbm90aWYoa2Fma2E6IG5vdGlmcyktLT5IZXJtZXNcbmthZmthX3B1c2h0ZWxlbWV0cnkoa2Fma2E6IHB1c2hfdGVsZW1ldHJ5KS0tPkhlcm1lc1xuUG9zZWlkb24tLT5rYWZrYV9ub3RpZlxudXNlcj51c2VyXS0tPnxodHRwfFRyaXRvblxuVHJpdG9uLS0-fGh0dHB8UG9zZWlkb25cbkhlcm1lcy0tPnx3c3x1c2VyMj51c2VyXVxuQXRoZW5hLS0-a2Fma2FfcHVzaHRlbGVtZXRyeVxuXG5jbGFzc0RlZiBjdXJyZW50Q21wIGZpbGw6bGlnaHRncmVlblxuY2xhc3NEZWYgb3RoZXJDbXAgZmlsbDpyZWRcbmNsYXNzIGFuZ2VsaWUgY3VycmVudENtcFxuY2xhc3Mgb3RoZXIsQXRoZW5hLEh5Z2llLEhlcm1lcyxUcml0b24sUG9zZWlkb24gb3RoZXJDbXAiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCIsInRoZW1lVmFyaWFibGVzIjp7ImJhY2tncm91bmQiOiJ3aGl0ZSIsInByaW1hcnlDb2xvciI6IiNFQ0VDRkYiLCJzZWNvbmRhcnlDb2xvciI6IiNmZmZmZGUiLCJ0ZXJ0aWFyeUNvbG9yIjoiaHNsKDgwLCAxMDAlLCA5Ni4yNzQ1MDk4MDM5JSkiLCJwcmltYXJ5Qm9yZGVyQ29sb3IiOiJoc2woMjQwLCA2MCUsIDg2LjI3NDUwOTgwMzklKSIsInNlY29uZGFyeUJvcmRlckNvbG9yIjoiaHNsKDYwLCA2MCUsIDgzLjUyOTQxMTc2NDclKSIsInRlcnRpYXJ5Qm9yZGVyQ29sb3IiOiJoc2woODAsIDYwJSwgODYuMjc0NTA5ODAzOSUpIiwicHJpbWFyeVRleHRDb2xvciI6IiMxMzEzMDAiLCJzZWNvbmRhcnlUZXh0Q29sb3IiOiIjMDAwMDIxIiwidGVydGlhcnlUZXh0Q29sb3IiOiJyZ2IoOS41MDAwMDAwMDAxLCA5LjUwMDAwMDAwMDEsIDkuNTAwMDAwMDAwMSkiLCJsaW5lQ29sb3IiOiIjMzMzMzMzIiwidGV4dENvbG9yIjoiIzMzMyIsIm1haW5Ca2ciOiIjRUNFQ0ZGIiwic2Vjb25kQmtnIjoiI2ZmZmZkZSIsImJvcmRlcjEiOiIjOTM3MERCIiwiYm9yZGVyMiI6IiNhYWFhMzMiLCJhcnJvd2hlYWRDb2xvciI6IiMzMzMzMzMiLCJmb250RmFtaWx5IjoiXCJ0cmVidWNoZXQgbXNcIiwgdmVyZGFuYSwgYXJpYWwiLCJmb250U2l6ZSI6IjE2cHgiLCJsYWJlbEJhY2tncm91bmQiOiIjZThlOGU4Iiwibm9kZUJrZyI6IiNFQ0VDRkYiLCJub2RlQm9yZGVyIjoiIzkzNzBEQiIsImNsdXN0ZXJCa2ciOiIjZmZmZmRlIiwiY2x1c3RlckJvcmRlciI6IiNhYWFhMzMiLCJkZWZhdWx0TGlua0NvbG9yIjoiIzMzMzMzMyIsInRpdGxlQ29sb3IiOiIjMzMzIiwiZWRnZUxhYmVsQmFja2dyb3VuZCI6IiNlOGU4ZTgiLCJhY3RvckJvcmRlciI6ImhzbCgyNTkuNjI2MTY4MjI0MywgNTkuNzc2NTM2MzEyOCUsIDg3LjkwMTk2MDc4NDMlKSIsImFjdG9yQmtnIjoiI0VDRUNGRiIsImFjdG9yVGV4dENvbG9yIjoiYmxhY2siLCJhY3RvckxpbmVDb2xvciI6ImdyZXkiLCJzaWduYWxDb2xvciI6IiMzMzMiLCJzaWduYWxUZXh0Q29sb3IiOiIjMzMzIiwibGFiZWxCb3hCa2dDb2xvciI6IiNFQ0VDRkYiLCJsYWJlbEJveEJvcmRlckNvbG9yIjoiaHNsKDI1OS42MjYxNjgyMjQzLCA1OS43NzY1MzYzMTI4JSwgODcuOTAxOTYwNzg0MyUpIiwibGFiZWxUZXh0Q29sb3IiOiJibGFjayIsImxvb3BUZXh0Q29sb3IiOiJibGFjayIsIm5vdGVCb3JkZXJDb2xvciI6IiNhYWFhMzMiLCJub3RlQmtnQ29sb3IiOiIjZmZmNWFkIiwibm90ZVRleHRDb2xvciI6ImJsYWNrIiwiYWN0aXZhdGlvbkJvcmRlckNvbG9yIjoiIzY2NiIsImFjdGl2YXRpb25Ca2dDb2xvciI6IiNmNGY0ZjQiLCJzZXF1ZW5jZU51bWJlckNvbG9yIjoid2hpdGUiLCJzZWN0aW9uQmtnQ29sb3IiOiJyZ2JhKDEwMiwgMTAyLCAyNTUsIDAuNDkpIiwiYWx0U2VjdGlvbkJrZ0NvbG9yIjoid2hpdGUiLCJzZWN0aW9uQmtnQ29sb3IyIjoiI2ZmZjQwMCIsInRhc2tCb3JkZXJDb2xvciI6IiM1MzRmYmMiLCJ0YXNrQmtnQ29sb3IiOiIjOGE5MGRkIiwidGFza1RleHRMaWdodENvbG9yIjoid2hpdGUiLCJ0YXNrVGV4dENvbG9yIjoid2hpdGUiLCJ0YXNrVGV4dERhcmtDb2xvciI6ImJsYWNrIiwidGFza1RleHRPdXRzaWRlQ29sb3IiOiJibGFjayIsInRhc2tUZXh0Q2xpY2thYmxlQ29sb3IiOiIjMDAzMTYzIiwiYWN0aXZlVGFza0JvcmRlckNvbG9yIjoiIzUzNGZiYyIsImFjdGl2ZVRhc2tCa2dDb2xvciI6IiNiZmM3ZmYiLCJncmlkQ29sb3IiOiJsaWdodGdyZXkiLCJkb25lVGFza0JrZ0NvbG9yIjoibGlnaHRncmV5IiwiZG9uZVRhc2tCb3JkZXJDb2xvciI6ImdyZXkiLCJjcml0Qm9yZGVyQ29sb3IiOiIjZmY4ODg4IiwiY3JpdEJrZ0NvbG9yIjoicmVkIiwidG9kYXlMaW5lQ29sb3IiOiJyZWQiLCJsYWJlbENvbG9yIjoiYmxhY2siLCJlcnJvckJrZ0NvbG9yIjoiIzU1MjIyMiIsImVycm9yVGV4dENvbG9yIjoiIzU1MjIyMiIsImNsYXNzVGV4dCI6IiMxMzEzMDAiLCJmaWxsVHlwZTAiOiIjRUNFQ0ZGIiwiZmlsbFR5cGUxIjoiI2ZmZmZkZSIsImZpbGxUeXBlMiI6ImhzbCgzMDQsIDEwMCUsIDk2LjI3NDUwOTgwMzklKSIsImZpbGxUeXBlMyI6ImhzbCgxMjQsIDEwMCUsIDkzLjUyOTQxMTc2NDclKSIsImZpbGxUeXBlNCI6ImhzbCgxNzYsIDEwMCUsIDk2LjI3NDUwOTgwMzklKSIsImZpbGxUeXBlNSI6ImhzbCgtNCwgMTAwJSwgOTMuNTI5NDExNzY0NyUpIiwiZmlsbFR5cGU2IjoiaHNsKDgsIDEwMCUsIDk2LjI3NDUwOTgwMzklKSIsImZpbGxUeXBlNyI6ImhzbCgxODgsIDEwMCUsIDkzLjUyOTQxMTc2NDclKSJ9fSwidXBkYXRlRWRpdG9yIjpmYWxzZX0)

## Build
Build go from source with
```sh
go mod download && go build -o angelie .
```
or use Dockerfile
```sh
docker build -t angelie .
```

## Run
### Parameters

| setting | default | env | sample |
| ------- | ------- | --- | ------ |
| mqtt-url | "" | MQTT_URL | -mqtt-url localhost |
| mqtt-port | 1883 | | -mqtt-port 1883 |
| mqtt-topic | "" | MQTT_TOPIC | -mqtt-topic device/+/telemtry |
| kakfa-broker | "" | KAFKA_BROKER | -kafka-broker localhost:9092 |
| kafka-verbose | false | | -kafka-verbose false |
| kafka-topic | "" | KAFKA_TOPIC | -kafka-topic telemetries |
| kafka-consumer-group | "" | KAFKA_CONSUMER_GROUP | -kafka-consumer-group consumergroup |
| kafka-client-id | "" |KAFKA_CLIENT_ID | -kafka-client-id clientid |
| kafka-partition-count | "" | KAFKA_PARTITION_COUNT | -kafka-partition-count 3 |
| kafka-eventhub | false | | -kafka-eventhub true |
| kafka-username | "" | KAFKA_USER_USERNAME | -kafka-username myusername |
| kafka-password* | "" | KAFKA_USER_PASSWORD | -kafka-password mysuperpassword |

<sup>*</sup> For EventHub broker, use EHConnectionString as password `-kafka-password Endpoint=sb://...` (username will be ignored)